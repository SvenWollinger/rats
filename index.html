<html lang="en">
    <head>
        <link rel="stylesheet" href="css/style.css">
        <link rel="icon" href="img/favicon.webp" />
        <title>rats - wollinger.io</title>
    </head>
    <body>
        <div id="gallery">
            <div style="width:100%;background-color:red;">
                <img class="pointer" onclick="closeGallery()" src="/img/close.svg" alt="Close Gallery">
            </div>
        </div>
        <h1 style="text-align: center;">My Rattos</h1>
        <div id="content">
            <div id="selectedRatArea" style="width:100%;">
                <div class="card">
                    <p><a href="/" style="color:black;"><img src="/img/home.svg" style="width:5vh;position:absolute;" alt="home"></a></p>
                    <div class="cardInner">
                        <div style="float:left;">
                            <h2 class="ratAboutInfoHeading" id="selectedRatName">Loading...</h2>
                            <h3 class="ratAboutInfoHeading">Born: <span id="selectedRatBorn">Loading...</span></h3>
                            <h3 class="ratAboutInfoHeading" id="selectedRatRBParent">Rainbow Bridge: <span id="selectedRatRB">Loading...</span></h3>
                            <button onclick="openGallery()">Test</button>
                        </div>
                        <div style="float:left;">
                            <img id="selectedRatBigPic" style="width:50vh" alt="Rat Big Pic" src="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script src="/js/ratloader.js"></script>
    <script>
        class Config {
            rats
        }

        function openGallery() {
            setSearchParam("gallery", "img/ph1.png")
            document.getElementById("gallery").style.display = "block"
        }

        function closeGallery() {
            clearSearchParam("gallery")
            document.getElementById("gallery").style.display = "none"
        }

        function setSearchParam(key, value) {
            let params = new URLSearchParams(window.location.search)
            params.set(key, value)
            window.history.pushState("", "", "?" + params.toString())
        }

        function clearSearchParam(key) {
            let params = new URLSearchParams(window.location.search)
            params.delete(key)
            window.history.pushState("", "", "?" + params.toString())
        }

        let params = new URLSearchParams(window.location.search)
        if(params.get("gallery") != null) {
            document.getElementById("gallery").style.display = "block"
        }

        get("/json/config.json", (json) => {
            let config = Object.assign(new Config(), JSON.parse(json))
            console.log("Config loaded:")
            console.log(config)

            let selectedRat = params.get("rat")
            let content = document.getElementById("content")
            if(selectedRat == null) {
                //content.innerHTML = `<h1 style="text-align:center;width:100%;">All Rattos:</h1>`
                config.rats.forEach((id) => {
                    loadRat(id, (rat) => {
                        let card = document.createElement("div")
                        card.className = "card"
                        let cardContent = document.createElement("div")
                        cardContent.className = "cardInner"
                        card.appendChild(cardContent)

                        let ratThumbnail = document.createElement("img")
                        ratThumbnail.src = rat.thumbnail
                        ratThumbnail.className = "ratThumbnail"
                        ratThumbnail.onclick = () => {
                            window.location = "/?rat=" + id
                        }
                        cardContent.appendChild(ratThumbnail)

                        let ratTitle = document.createElement("h1")
                        ratTitle.innerText = rat.name
                        if(rat.passed != null) ratTitle.innerText += " â€ "
                        ratTitle.style.textAlign = "center"
                        ratTitle.style.color = "black"
                        cardContent.appendChild(ratTitle)

                        content.appendChild(card)
                    })
                })
            } else {
                if(config.rats.includes(selectedRat)) {
                    loadRat(selectedRat, (rat) => {
                        document.getElementById("selectedRatName").innerText = rat.name
                        document.getElementById("selectedRatArea").style.display = "flex"
                        document.getElementById("selectedRatBigPic").src = rat.bigPic
                        document.getElementById("selectedRatBorn").innerText = rat.born
                        if(rat.passed != null)
                            document.getElementById("selectedRatRB").innerText = rat.passed
                        else
                            document.getElementById("selectedRatRBParent").style.display = "none"
                    })
                } else {
                    document.getElementById("content").innerHTML =
                        "<div style='text-align:center'><p>Rat not found!</p>" +
                        "<a href='/'>Go back?</a></div>"
                }
            }
        })




    </script>
</html>